var version={buildTime:"2021/6/17\u4e0b\u53483:07:40",buildVersion:73};let rich={version:"1.0.0",logLv:0,buildInfo:{buildTime:"2019-11-28 17:06:21",buildVersion:10},session:null,initLib:function(){if(!this.hasInit){this.hasInit=!0,this.dev="h5",cc.sys.isNative?this.dev="app":cc.sys.platform==cc.sys.WECHAT_GAME?this.dev="wechat":this.dev="h5";try{void 0!==version&&(this.buildInfo=version)}catch(e){}if(this.session=this.urlParse(),cc.game.on(cc.game.EVENT_HIDE,function(){window.rich.log("\u6e38\u620f\u8fdb\u5165\u540e\u53f0",Math.random()),cc.audioEngine.pauseAll(),window.rich.eventManager.sendEvent("ENTER_BACKGROUND")}),cc.game.on(cc.game.EVENT_SHOW,function(){window.rich.log("\u6e38\u620f\u8fdb\u5165\u524d\u53f0",Math.random()),cc.audioEngine.resumeAll(),window.rich.eventManager.sendEvent("ENTER_FOREGROUND")}),cc.sys.platform!=cc.sys.WECHAT_GAME&&!cc.sys.isNative){var e,t,n=0,o=0,i=0;window.DeviceMotionEvent&&window.addEventListener("devicemotion",function(a){var c=a.accelerationIncludingGravity,r=(new Date).getTime();if(r-n>10){var s=r-n;n=r,e=c.x,t=c.y,c.z,Math.sqrt(Math.pow(e-o,2)+Math.pow(t-i,2))/s>.8&&this.eventManager.sendEvent("SHAKE_PHONE"),o=e,i=t}},!1)}cc.log("==============================================================================================="),cc.log("rich-creatorlib-ts"),cc.log("===============================================================================================")}},enableLog:function(e){this.logLv=e?1:0},log:function(...e){this.logLv&&console.log("[rich log]"+(new Date).Format("yyyy/MM/dd hh:mm:ss")+" ",...e)},urlParse:function(){var e,t,n={};if(null==window.location)return n;for(var o=window.location.href,i=o.indexOf("?"),a=(o=o.substr(i+1)).split("&"),c=0;c<a.length;c++)(i=a[c].indexOf("="))>0&&(e=a[c].substring(0,i),t=a[c].substr(i+1),n[e]=decodeURIComponent(t));return n}};window.rich=window.rich||rich,window.rich.initLib(),rich.BaseCtrl=cc.Class({extends:cc.EventTarget,properties:{gt:0},ctor:function(){this.init()},init:function(){},initCtrl:function(){},reqHttp:function(e,t,n,o,i,a){rich.handlerManager.doHttpHandler(e,t,n,o,i,a)},reqSocekt:function(e,t,n,o,i){t._GT=this.gt,rich.handlerManager.doGoSocketHandler(e,t,n,o,i)},addEvent:function(e,t){e&&t&&rich.eventManager.addEventListener(e,t,this)},removeEvents:function(){rich.eventManager.removeEventListenerByTarget(this)},onDestroy:function(){this.removeEvents()}}),rich.WebSocket=rich.WebSocket||window.WebSocket||window.MozWebSocket,rich.BaseWebSocket=cc.Class({properties:{_url:"",_wssCer:null,_websocket:null,_sendTime:0,_callbacks:null,_preCallbacks:null,_isClose:!1,_updateFunc:null,_pingTime:0,_isConnected:!1},initWithUrl:function(e,t){this._wssCer=t,this._url=e,this._callbacks={},this._preCallbacks={}},connect:function(){var e=this;if(!this._url||0==this._url.length)return rich.log("\u94fe\u63a5websocket\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"),rich.eventManager.sendEvent("WEBSOCKET_INIT_FAILED",this._url),void this.cleanUp();this._isConnected=!1;var t=new rich.WebSocket(this._url);this._websocket=t,t.onopen=function(t){e.onopen(t)},t.onclose=function(t){e.onclose(t)},t.onmessage=function(t){e.onmessage(t)},t.onerror=function(t){e.onerror(t)}},onopen:function(){rich.log("ws connected",this._url),this._isConnected=!0;var e=this;this._updateFuncId&&(clearInterval(this._updateFuncId),this._updateFuncId=null),this._updateFuncId=setInterval(function(){e.ping()},1e4),rich.log("\u5f00\u59cb\u5fc3\u8df3",this._updateFuncId),rich.eventManager.sendEvent("WEBSOCKET_CONNECTED",this._url)},onclose:function(){rich.log("ws close",this._updateFuncId),this.cleanUp(),this._websocket=null,rich.eventManager.sendEvent("WEBSOCKET_CLOSE",this._url)},onmessage:function(){},onerror:function(e){rich.log("ws error",rich.json.encode(e)),this.cleanUp(),rich.eventManager.sendEvent("WEBSOCKET_ERROR",this._url)},ping:function(){},getPingTime:function(){return this._pingTime},isClosed:function(){return this._isClose},setPreCallback:function(e,t){e&&t&&(this._preCallbacks[e]||(this._preCallbacks[e]=[]),this._preCallbacks[e].push(t))},setCallback:function(e,t){e&&t&&(this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t))},excuteCallback:function(e,t,n){for(var o in this._preCallbacks){var i=this._preCallbacks[o];if(i&&i.length>0)for(var a in i)this.setCallback(o,i[a])}if(this._preCallbacks={},e)try{if(this._callbacks[e]){for(var a in this._callbacks[e]){var c=this._callbacks[e][a];c&&c[t]&&("succuss"==t?c[t](n):c[t](n.error,n.msg,n.data))}this._callbacks[e]=[]}}catch(e){rich.log("excuteCallback err",e)}},parseBinaryMsg:function(){},parseMsg:function(){},sendMsg:function(e,t){t&&this.setPreCallback(t.key,t),this.send(e)},sendBinaryMsg:function(e,t){t&&this.setPreCallback(t.key,t),this.send(e)},send:function(e){this._websocket&&this._websocket.readyState==WebSocket.OPEN?(this._sendTime=(new Date).getTime(),this._websocket.send(e)):rich.log("send text websocket instance wasn't ready...")},close:function(){this._websocket&&this._websocket.close(),this.cleanUp()},cleanUp:function(){this._isClose=!0,this._updateFuncId&&(rich.log("\u6e05\u7406\u5fc3\u8df3",this._updateFuncId),clearInterval(this._updateFuncId),this._updateFuncId=null)}}),rich.ObjectBase=cc.Class({properties:{_id:0,_propertys:null,_eventList:null},ctor:function(){this.initProp(),this.init(),++rich.ObjectBase.ID,this._id=rich.ObjectBase.ID,this._eventList={}},initProp:function(){this._propertys={}},init:function(){},getId:function(){return this._id},get:function(e){return this._propertys[e]},set:function(e,t){null!=e&&(this._propertys[e]=t)}}),rich.ObjectBase.ID=0,rich.ModelBase=cc.Class({extends:rich.ObjectBase,initWithJson:function(e){if(null==e)return rich.log("initWithJson get nil param"),!1;var t=rich.json.decode(e);return this.initWithObject(t),this.initModelEnd(),!0},initWithObject:function(e){if(null==e)return rich.log("initWithObject get nil param"),!1;for(var t in e)"number"==typeof this.get(t)?this.set(t,Number(e[t])):this.set(t,e[t]);return this.initModelEnd(),!0},initModelEnd:function(){},toJson:function(){return rich.json.encode(this._propertys)},toObject:function(){var e={};for(var t in this._propertys)e[t]=String(this._propertys[t]);return e}}),rich.LocalData=cc.Class({name:"LocalData",extends:rich.ModelBase,init:function(){this.set("isNewUser",1)}}),rich.NodeBase=cc.Class({extends:cc.Component,properties:{uiData:{default:null,visible:!1}},onLoad:function(){this.parseParams(this.node),this._created=!0,this._delayShowData&&(this._delayShowData=!1,this.onDataChanged()),this.onCreate()},onCreate:function(){},onExit:function(){},setUIData:function(e){this.uiData=e,this._created?this.onDataChanged():this._delayShowData=!0},onDataChanged:function(){},setOpacityMask:function(e){rich.utils.setNodeOpacityMask(this.node,e)},setTouchMask:function(e){rich.utils.setNodeTouchMask(this.node,e)},start:function(){},update:function(){},lateUpdate:function(){},onDestroy:function(){this.removeEvents(),this.onExit()},onEnable:function(){},onDisable:function(){},parseParams:function(e){if(!e)return;let t=e.children;if(t&&t.length>0)for(let i in t){let e=t[i];this.parseParams(e)}let n=!1,o=e;switch(e.name.split("_")[0]){case"btn":rich.utils.addClickEvent(e,this.node,cc.js.getClassName(this),"onBtnClicked"),o=e.getComponent(cc.Button),n=!0;break;case"lbt":n=!0,o=e.getComponent(cc.Label);break;case"sp":n=!0,o=e.getComponent(cc.Sprite);break;case"imgBtn":n=!0,rich.utils.addClickEvent(e,this.node,cc.js.getClassName(this),"onImgClicked",cc.Button.Transition.NONE),o=e.getComponent(cc.Sprite);break;case"node":n=!0;break;case"rtxt":n=!0,o=e.getComponent(cc.RichText);break;case"rtxtext":n=!0,o=e.getComponent(rich.RichTextExt);break;case"par":n=!0,o=e.getComponent(cc.ParticleSystem);break;case"tmap":n=!0,o=e.getComponent(cc.TiledMap);break;case"tile":n=!0,o=e.getComponent(cc.TiledTile);break;case"scroll":n=!0,o=e.getComponent(cc.ScrollView);break;case"slider":n=!0,o=e.getComponent(cc.Slider);break;case"page":rich.utils.addPageEvent(e,this.node,cc.js.getClassName(this),"onPageEvent"),n=!0,o=e.getComponent(cc.PageView);break;case"bar":n=!0,o=e.getComponent(cc.ProgressBar);break;case"toggle":rich.utils.addCheckEvent(e,this.node,cc.js.getClassName(this),"onToggleCheck"),n=!0,o=e.getComponent(cc.Toggle);break;case"input":n=!0,o=e.getComponent(cc.EditBox);break;case"audio":n=!0,o=e.getComponent(cc.AudioSource);break;case"dragonBone":n=!0,o=e.getComponent(dragonBones.ArmatureDisplay);break;case"cp":n=!0,o=e.getComponent(rich.ChooseOption);break;case"layout":n=!0,o=e.getComponent(cc.Layout);break;case"richAni":n=!0,o=e.getComponent(rich.FrameAni);break;case"camera":n=!0,o=e.getComponent(cc.Camera)}n&&(this[e.name]=o)},onBtnClicked:function(e){rich.soundManager.playBtnEffect();let t=e.target.name.split("_")[1];if(t){let n=this["press_"+t];"function"==typeof n&&n.call(this,e)}},onImgClicked:function(e){let t=e.target.name.split("_")[1];if(t){let n=this["press_"+t];"function"==typeof n&&n.call(this,e)}},onToggleCheck:function(e){let t=e.node.name.split("_")[1];if(t){let n=this["check_"+t];"function"==typeof n&&n.call(this,e)}},onPageEvent:function(e,t,n){let o=e.node.name.split("_")[1];if(o){let i=this["onPageEvent_"+o];"function"==typeof i&&i.call(this,e,t,n)}},getNodeByName:function(e,t){if(e){if(e.getChildByName(t))return e.getChildByName(t);let n=e.children;if(!(n&&n.length>0))return e.getChildByName(t);for(let e in n){let o=n[e],i=this.getNodeByName(o,t);if(i)return i}}return null},addEvent:function(e,t){e&&t&&rich.eventManager.addEventListener(e,t,this)},removeEvents:function(){rich.eventManager.removeEventListenerByTarget(this)},press_close:function(){this.close()},close:function(){if(cc.isValid(this.node,!0)){let t=this.node.getComponent(rich.PopUpComponent);if(t)t.close();else try{this.node.destroy()}catch(e){rich.log("close error",e)}}}}),rich.PopBase=cc.Class({extends:rich.NodeBase,properties:{isShowIn:{tooltip:"\u662f\u5426\u6253\u5f00\u7684\u65f6\u5019\u6de1\u5165",default:!0},showInTime:{tooltip:"\u6de1\u5165\u65f6\u95f4",default:.3},showOutTime:{tooltip:"\u6de1\u51fa\u65f6\u95f4",default:.3}},onCreate:function(){var e=this;this.addEvent("RESIZE_SCREEN",function(){e.node&&(e.node.x=cc.winSize.width/2,e.node.y=cc.winSize.height/2)}),this.isShowIn&&this.showIn()},showIn:function(){var e=this;this.node.opacity=0,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(0,{scale:2}).to(this.showInTime,{opacity:255,scale:1}).call(function(){e.showInEnd()}).start()},showInEnd:function(){},showOut:function(){var e=this;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(this.showOutTime,{opacity:0,scale:2}).call(function(){e.showOutEnd(),e.node.destroy()}).start()},showOutEnd:function(){},close:function(){this.showOut()}}),rich.SceneBase=cc.Class({extends:rich.NodeBase,properties:{},onLoad:function(){rich.NodeBase.prototype.onLoad.call(this),rich.utils.setFitSreenMode()}}),rich.TouchMask=cc.Class({extends:cc.Component,properties:{removeWhenTouch:{tooltip:"\u662f\u5426\u70b9\u51fb\u5c4f\u5e55\u754c\u9762\u5c31\u79fb\u9664\u6389",default:!1}},onLoad:function(){var e=this,t=new cc.Node;t.setContentSize(cc.winSize),this.node.addChild(t,-1),t.on(cc.Node.EventType.TOUCH_START,function(t){t.stopPropagation(),e.removeWhenTouch&&e.node.destroy()}),this._resizeEvent=rich.eventManager.addEventListener("RESIZE_SCREEN",function(){t.setContentSize(cc.winSize)},this)},onDestroy:function(){rich.eventManager.removeEventListenerByTarget(this)}}),rich.OpacityMask=cc.Class({extends:cc.Component,properties:{opacity:{tooltip:"\u906e\u7f69\u5c42\u7684\u900f\u660e\u5ea6",default:125}},onLoad:function(){var e=new cc.Node;e.color=cc.color(0,0,0),e.opacity=this.opacity,this._opacityNode=e;var t=e.addComponent(cc.Sprite);e.setContentSize(cc.winSize),t.sizeMode=cc.Sprite.SizeMode.CUSTOM,rich.loaderManager.loadImage("richkit/res/singleColor",function(e){if(e instanceof cc.Texture2D){var n=new cc.SpriteFrame(e);t.node&&(t.spriteFrame=n)}}),this.node.addChild(e,-1),this._resizeEvent=rich.eventManager.addEventListener("RESIZE_SCREEN",function(){e.setContentSize(cc.winSize)},this)},onDestroy:function(){rich.eventManager.removeEventListenerByTarget(this)},setOpacity:function(e){try{this._opacityNode&&(this._opacityNode.opacity=e||0)}catch(e){rich.log("setOpacity error",e)}}});let dragonBoneManager={addNewDragonBoneNodeToNode:function(e,t,n){cc.loader.loadResDir(t,function(t,o){var i=new cc.Node;e.addChild(i);for(var a=i.addComponent(dragonBones.ArmatureDisplay),c=0;c<o.length;c++)o[c]instanceof dragonBones.DragonBonesAsset&&(a.dragonAsset=o[c]),o[c]instanceof dragonBones.DragonBonesAtlasAsset&&(a.dragonAtlasAsset=o[c]);if(a.armatureName="Armature",n)try{n(i)}catch(t){rich.log("DragonBoneManager catch error",t)}})},addDragonBoneComponentToNode:function(e,t,n){cc.loader.loadResDir(t,function(t,o){var i=function(){for(var t=e.addComponent(dragonBones.ArmatureDisplay),i=0;i<o.length;i++)o[i]instanceof dragonBones.DragonBonesAsset&&(t.dragonAsset=o[i]),o[i]instanceof dragonBones.DragonBonesAtlasAsset&&(t.dragonAtlasAsset=o[i]);if(t.armatureName="Armature",n)try{n()}catch(e){rich.log("DragonBoneManager catch error",e)}};e.getComponent(dragonBones.ArmatureDisplay)?(e.removeComponent(dragonBones.ArmatureDisplay),cc.Tween.stopAllByTarget(e),cc.tween(e).delay(0).call(i).start()):i()})},changeDragonBoneRes:function(e,t,n){cc.loader.loadResDir(t,function(t,o){var i=e.getComponent(dragonBones.ArmatureDisplay);if(i)for(var a=0;a<o.length;a++)o[a]instanceof dragonBones.DragonBonesAsset&&(i.dragonAsset=o[a]),o[a]instanceof dragonBones.DragonBonesAtlasAsset&&(i.dragonAtlasAsset=o[a]);else rich.log("\u4f20\u5165\u7684\u66ff\u6362dragonbone\u8d44\u6e90\u7684\u8282\u70b9\u6ca1\u6709\u6302\u8f7ddragonbone\u7ec4\u4ef6",i);if(n)try{n()}catch(t){rich.log("DragonBoneManager catch error",t)}})}};rich.dragonBoneManager=rich.dragonBoneManager||dragonBoneManager;let spineManager={loadSpineDir:function(e,t){if(!e)return void(t&&t(null));let n=e.slice(e.lastIndexOf("/")+1),o=cc.loader.getRes(`${e}/${n}`,sp.SkeletonData);o?t&&t(o):cc.loader.loadResDir(e,function(e,n){try{if(e)rich.log("SpineManager error",e),t&&t(null);else for(var o=0;o<n.length;o++)if(n[o]instanceof sp.SkeletonData)return void(t&&t(n[o]))}catch(e){rich.log("SpineManager catch error",e)}})},addNewSpineNodeToNode:function(e,t,n){this.loadSpineDir(e,function(e){try{var o=null;e&&(o=new cc.Node,t.addChild(o),o.addComponent(sp.Skeleton).skeletonData=e),n&&n(o)}catch(e){rich.log("SpineManager catch error",e)}})},addSpineComponentToNode:function(e,t,n){this.loadSpineDir(e,function(e){var o=function(){try{e&&(t.addComponent(sp.Skeleton).skeletonData=e),n&&n()}catch(e){rich.log("SpineManager catch error",e)}};t.getComponent(sp.Skeleton)?(t.removeComponent(sp.Skeleton),cc.Tween.stopAllByTarget(t),cc.tween(t).delay(0).call(o).start()):o()})},changeSpineRes:function(e,t,n){this.loadSpineDir(e,function(e){try{t.getComponent(sp.Skeleton).skeletonData=e,n&&n()}catch(e){rich.log("SpineManager catch error",e)}})}};rich.spineManager=rich.spineManager||spineManager;let eventManager={addEventListener:function(e,t,n){return cc.systemEvent.on(e,t,n)},sendEvent:function(e,t){cc.systemEvent.emit(e,t)},removeEventListenerByTarget:function(e){cc.systemEvent.targetOff(e)},removeEventListener:function(e,t){cc.systemEvent.off(e,t)}};rich.eventManager=rich.eventManager||eventManager;let globalDataManager={user:null,loginServer:"",wsServer:"",_sessionData:null,localData:null,loadLocalData:function(e){this.localData=e||new rich.LocalData;var t=cc.sys.localStorage.getItem("localData");t&&rich.GameConfig&&rich.GameConfig.loadSaveUser?this.localData.initWithJson(t):cc.sys.localStorage.setItem("localData",this.localData.toJson());let n=(new Date).toDateString();this.localData.get("date")!=n&&(this.localData.set("date",n),this.localData.set("todayRound",0))},saveLocalData:function(){cc.sys.localStorage.setItem("localData",this.localData.toJson())}};rich.globalDataManager=rich.globalDataManager||globalDataManager;let handlerManager={doHttpHandler:function(e,t,n,o,i,a){e=e+"/"+t;var c=null,r=!1;a&&rich.prefabManager.loadPrefab("richkit/Loading",function(e){r||(e.zIndex=10,c=e,rich.prefabManager.addPrefabToScene(e))}),rich.httpManager.post(e,rich.json.encode(n),function(e){if(r=!0,c&&cc.isValid(c,!0))try{c.destroy(),c=null}catch(e){rich.log("removeloading catch err")}o&&o(e)},function(e,t,n){if(r=!0,c&&cc.isValid(c,!0))try{c.destroy(),c=null}catch(e){rich.log("removeloading catch err")}100001==e?rich.alert.show("\u672a\u767b\u5f55",function(){rich.sceneManager.gotoScene("scene_login")}):i&&i(e,t,n)})},doHttpHandlerWithRouter:function(e,t,n,o,i,a,c){cc.sys.platform!=cc.sys.WECHAT_GAME&&(t=t.replace("xcx","")),e=e+"/"+t+"/"+n;var r=null,s=!1;c&&rich.prefabManager.loadPrefab("richkit/Loading",function(e){s||(e.zIndex=10,r=e,rich.prefabManager.addPrefabToScene(e))}),rich.httpManager.post(e,rich.json.encode(o),function(e){if(s=!0,r&&cc.isValid(r,!0))try{r.destroy(),r=null}catch(e){rich.log("removeloading catch err")}i&&i(e)},function(e,t,n){if(s=!0,r&&cc.isValid(r,!0))try{r.destroy(),r=null}catch(e){rich.log("removeloading catch err")}a&&a(e,t,n)})},doGoSocketHandler:function(e,t,n,o,i){var a=null,c=!1;i&&rich.prefabManager.loadPrefab("richkit/Loading",function(e){c||(e.zIndex=10,a=e,rich.prefabManager.addPrefabToScene(e))}),t._GT=t._GT||0,t.custom=1;var r={key:t.method,succuss:function(e){if(c=!0,a&&cc.isValid(a,!0))try{a.destroy(),a=null}catch(e){rich.log("removeloading catch err")}n&&n(e)},failed:function(e,t,n){if(c=!0,a&&cc.isValid(a,!0))try{a.destroy(),a=null}catch(e){rich.log("removeloading catch err")}o&&o(e,t,n)}},s=rich.base64.encode(rich.json.encode(t));"Echo"!=t.method&&rich.log("\u53d1\u9001\u6570\u636e",rich.json.encode(t),s),rich.wsManager.sendMsg(e,s,r)}};rich.handlerManager=rich.handlerManager||handlerManager;let httpManager={token:null,post:function(e,t,n,o){var i=rich.base64.encode(t),a=cc.loader.getXMLHttpRequest();a.open("POST",e),a.setRequestHeader("content-type","text/plain"),this.token&&a.setRequestHeader("token",this.token),a.onreadystatechange=function(){if(4==a.readyState)if(a.status>=200&&a.status<=207){a.statusText;var e=a.responseText,t=rich.base64.decode(e);rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",t);var i=rich.json.decode(t);i?i.hasOwnProperty("flag")?i.flag&&i.flag>0?o&&o(i.flag,i.msg,i):n&&n(i.val):i.hasOwnProperty("error")&&(i.error&&i.error>0?o&&o(i.error,i.msg,i):n&&n(i.ok)):(rich.log("json\u89e3\u6790 \u5931\u8d25"),o&&o(0))}else rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",a.status)},a.onerror=function(e){rich.log("onerror",e),o&&o(-101)},a.onabort=function(){rich.log("onabort"),o&&o(-102)},a.ontimeout=function(){rich.log("ontimeout"),o&&o(-103)},rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t,i),a.send(i)},postNoEncryptToGoumaiServer:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),i.setRequestHeader("content-type","text/plain"),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207?(i.statusText,rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",i.responseText),n&&n(i.responseText)):(rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)))},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)},i.send(t)},postNoEncrypt:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),i.setRequestHeader("content-type","text/plain"),this.token&&i.setRequestHeader("token",this.token),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207?(i.statusText,rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",i.responseText),n&&n(i.responseText)):(rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)))},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)},i.send(t)},get:function(e,t,n){rich.log("\u53d1\u9001get\u8bf7\u6c42",e);var o=cc.loader.getXMLHttpRequest();o.open("GET",e,!0),this.token&&o.setRequestHeader("token",this.token),o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<=207?(o.statusText,t&&t(o.responseText)):n&&n(o.status))},o.onerror=function(){n&&n(-101)},o.onabort=function(){n&&n(-102)},o.ontimeout=function(){n&&n(-103)},o.send()},postFormData:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),this.token&&i.setRequestHeader("token",this.token),i.onreadystatechange=function(){if(4==i.readyState)if(i.status>=200&&i.status<=207){i.statusText;var e=rich.base64.decode(i.responseText);rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",e,i.responseText),n&&n(e)}else rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)};let a=null;if(cc.sys.isNative||cc.sys.platform!=cc.sys.WECHAT_GAME){a=new FormData;for(let e in t)a.append(e,t[e])}else a=t;i.send(a)}};rich.httpManager=rich.httpManager||httpManager;let ajax={token:null,_formatParams:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")},postTxtData:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),i.setRequestHeader("Content-type","text/plain; charset=UTF-8"),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207?(i.statusText,rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",i.responseText),n&&n(i.responseText)):(rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)))},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)},i.send(t)},postFormData:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207?(i.statusText,rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",i.responseText),n&&n(i.responseText)):(rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)))},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)},i.send(this._formatParams(t))},postJsonData:function(e,t,n,o){rich.log("\u53d1\u9001pos\u8bf7\u6c42",e,t);var i=cc.loader.getXMLHttpRequest();i.open("POST",e),i.setRequestHeader("Content-type","application/json; charset=utf-8"),i.onreadystatechange=function(){4==i.readyState&&(i.status>=200&&i.status<=207?(i.statusText,rich.log("\u53d1\u9001pos\u8bf7\u6c42\u6210\u529f",i.responseText),n&&n(i.responseText)):(rich.log("\u53d1\u9001pos\u8bf7\u6c42\u5931\u8d25",i.status,i.statusText,i.responseText),o&&o(i.status)))},i.onerror=function(){o&&o(-101)},i.onabort=function(){o&&o(-102)},i.ontimeout=function(){o&&o(-103)},i.send(JSON.stringify(t))}};rich.ajax=rich.ajax||ajax;let loaderManager={loadVoice:function(e,t){e=e?e.replace(".mp3",""):e;let n=function(e){if(t)try{t(e)}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},o=cc.loader.getRes(e);if(o)n(o);else try{cc.loader.loadRes(e,cc.AudioClip,function(e,o){e?(t(null,e),rich.log("\u52a0\u8f7d\u97f3\u4e50\u8d44\u6e90\u5931\u8d25",e)):n(o)})}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},loadSpriteFrame:function(e,t){let n=function(e){if(t)try{e instanceof cc.Texture2D?t(new cc.SpriteFrame(e)):e instanceof cc.SpriteFrame&&t(e)}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},o=cc.loader.getRes(e);if(o)n(o);else try{cc.loader.loadRes(e,function(e,o){e?(t(null,e),rich.log("LoaderManager catch error",e)):n(o)})}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},loadImage:function(e,t){let n=function(e){if(t)try{t(e)}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},o=cc.loader.getRes(e);if(o)n(o);else try{cc.loader.loadRes(e,function(e,o){e?(t(null,e),rich.log("LoaderManager catch error",e)):n(o)})}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},loadRemoteImg:function(e,t,n){if(!e||e.length<=0)return;var o={url:e,type:n=n||"png"};let i=function(e){if(e instanceof cc.Texture2D){var n=new cc.SpriteFrame(e);if(t)try{t(n)}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}}},a=cc.loader.getRes(e);if(a)rich.log("\u4ece\u7f13\u5b58\u83b7\u53d6\u8fdc\u7a0b\u56fe\u7247\u8d44\u6e90===",e),i(a);else try{rich.log("\u52a0\u8f7d\u8fdc\u7a0b\u56fe\u7247\u8d44\u6e90===",e),cc.loader.load(o,function(e,n){if(e)return t(null,e),void rich.log("\u52a0\u8f7d\u8fdc\u7a0b\u56fe\u7247\u8d44\u6e90\u5931\u8d25");i(n)})}catch(e){t(null,e),rich.log("LoaderManager catch error",e)}},loadBundle(e,t){cc.assetManager.loadBundle(e,(e,n)=>{t&&t(n,e)})},loadBundleRes(e,t,n){let o=cc.assetManager.getBundle(e);o?o.load(t,function(e,t){n&&n(t,e)}):(cc.log("\u8d44\u6e90\u672a\u52a0\u8f7d"),n&&n(null))}};rich.loaderManager=rich.loaderManager||loaderManager;let prefabManager={loadLoadingPrefab:function(e,t){0==e.indexOf("resources")&&(e=e.slice(e.indexOf("/")));let n=cc.loader.getRes(e);if(n)try{var o=cc.instantiate(n);t&&t(o)}catch(e){rich.log("loadLoadingPrefab \u5931\u8d25",e)}else cc.loader.loadRes(e,function(e,n){if(e)rich.log("\u8f7d\u5165\u9884\u5236\u8d44\u6e90\u5931\u8d25, \u539f\u56e0:"+e);else if(n instanceof cc.Prefab)try{var o=cc.instantiate(n);t&&t(o)}catch(e){rich.log("\u5b9e\u4f8b\u5316 loadLoadingPrefab \u5931\u8d25",e)}else rich.log("\u4f60\u8f7d\u5165\u7684\u4e0d\u662f\u9884\u5236\u8d44\u6e90!")})},loadPrefab:function(e,t){let n=this;0==e.indexOf("resources")&&(e=e.slice(e.indexOf("/")));let o=cc.loader.getRes(e);if(o)try{var i=cc.instantiate(o);t&&t(i)}catch(e){rich.log("loadPrefab \u56de\u8c03\u5931\u8d25",e)}else{var a=null,c=!1;n.loadLoadingPrefab("richkit/Loading",function(e){c||(e.zIndex=10,a=cc.instantiate(e),n.addPrefabToScene(a))}),cc.loader.loadRes(e,function(e,n){if(c=!0,a&&cc.isValid(a,!0))try{a.destroy(),a=null}catch(e){rich.log("removeloading catch err",e)}if(e)rich.log("\u8f7d\u5165\u9884\u5236\u8d44\u6e90\u5931\u8d25, \u539f\u56e0:"+e);else if(n instanceof cc.Prefab)try{var o=cc.instantiate(n);t&&t(o)}catch(e){rich.log("\u5b9e\u4f8b\u5316\u9884\u5236\u8d44\u6e90\u5931\u8d25",e)}else rich.log("\u4f60\u8f7d\u5165\u7684\u4e0d\u662f\u9884\u5236\u8d44\u6e90!")})}},addPrefabToNode:function(e,t,n,o,i,a){var c=function(t){if(t&&e){if(a&&(t.x=a.x||0,t.y=a.y||0),o&&i){let e=t.getComponent(o);e&&e.setUIData&&e.setUIData(i)}t.parent=e;try{n&&n(t)}catch(e){rich.log("\u6dfb\u52a0\u9884\u5236\u8d44\u6e90\u5230\u8282\u70b9\u5931\u8d25",e)}}};if("object"==typeof t){var r=t;t instanceof cc.Prefab&&(r=cc.instantiate(t)),c(r)}else"string"==typeof t?this.loadPrefab(t,function(e){c(e)}):rich.log("\u4e0d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b",typeof t)},addPrefabToScene:function(e,t,n,o,i){var a=function(e){if(e){i?(e.x=i.x||cc.winSize.width/2,e.y=i.y||cc.winSize.height/2):(e.x=cc.winSize.width/2,e.y=cc.winSize.height/2);var a=cc.director.getScene();if(n&&o){let t=e.getComponent(n);t&&t.setUIData&&t.setUIData(o)}e.parent=a;try{t&&t(e)}catch(e){rich.log("\u6dfb\u52a0\u9884\u5236\u8d44\u6e90\u5230\u573a\u666f\u5931\u8d25",e)}}};if("object"==typeof e){var c=e;e instanceof cc.Prefab&&(c=cc.instantiate(e)),a(c)}else"string"==typeof e?this.loadPrefab(e,function(e){a(e)}):rich.log("\u4e0d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b",typeof e)},addPrefabToCanvas:function(e,t,n,o,i){var a=function(e){if(e){i&&(e.x=i.x||0,e.y=i.y||0);var a=cc.find("Canvas");if(n&&o){let t=e.getComponent(n);t&&t.setUIData&&t.setUIData(o)}e.parent=a;try{t&&t(e)}catch(e){rich.log("\u6dfb\u52a0\u9884\u5236\u8d44\u6e90\u5230Canvas\u5931\u8d25",e)}}};if("object"==typeof e){var c=e;e instanceof cc.Prefab&&(c=cc.instantiate(e)),a(c)}else"string"==typeof e?this.loadPrefab(e,function(e){a(e)}):rich.log("\u4e0d\u652f\u6301\u7684\u53c2\u6570\u7c7b\u578b",typeof e)},addPrefabNodeToScene:function(e,t,n,o){if(e){o?(e.x=o.x||cc.winSize.width/2,e.y=o.y||cc.winSize.height/2):(e.x=cc.winSize.width/2,e.y=cc.winSize.height/2);var i=cc.director.getScene();if(t&&n){let o=e.getComponent(t);o&&o.setUIData&&o.setUIData(n)}e.parent=i}}};rich.prefabManager=rich.prefabManager||prefabManager;let sceneManager={initConfigEnd:!1,params:{},_designWidth:1136,_designHeight:640,_persistRootNode:null,_isLoadingScene:!1,getPersistRootNode:function(){let e=cc.director.getScene();if(e){if(!this._persistRootNode){this._persistRootNode=new cc.Node,this._persistRootNode.anchorX=0,this._persistRootNode.anchorY=0;let t=this._persistRootNode.addComponent(cc.Widget);t.top=0,t.left=0,t.right=0,t.bottom=0,t.isAlignTop=!0,t.isAlignLeft=!0,t.isAlignBottom=!0,t.isAlignRight=!0,t.alignMode=cc.Widget.AlignMode.ALWAYS,this._persistRootNode.parent=e,this._persistRootNode.zIndex=10,cc.game.addPersistRootNode(this._persistRootNode)}return this._persistRootNode}return null},gotoScene:function(e,t,n){let o=this;if(!this._isLoadingScene){var i=!1;this._isLoadingScene=!0,this.params[e]=n,rich.prefabManager.loadPrefab("richkit/Loading",function(e){i||(e.zIndex=10,rich.prefabManager.addPrefabToScene(e))}),rich.soundManager.stopAll(),cc.director.preloadScene(e,function(){},function(){t&&t(),i=!0,o._isLoadingScene=!1,cc.director.loadScene(e)})}},getParam:function(e){return this.params[e]},resizeScreen:function(){var e=0,t=0;if(cc.sys.isNative)e=cc.winSize.width,t=cc.winSize.height;else if(cc.sys.platform==cc.sys.WECHAT_GAME){let n=wx.getSystemInfoSync();t=n.windowHeight,e=n.windowWidth}else 180==window.orientation||window.orientation,90==window.orientation||window.orientation,window.innerWidth?e=window.innerWidth:document.body&&document.body.clientWidth&&(e=document.body.clientWidth),window.innerHeight?t=window.innerHeight:document.body&&document.body.clientHeight&&(t=document.body.clientHeight),document.documentElement&&document.documentElement.clientHeight&&document.documentElement.clientWidth&&(t=document.documentElement.clientHeight,e=document.documentElement.clientWidth);e/t>=this._designWidth/this._designHeight?cc.view.setDesignResolutionSize(this._designWidth,this._designHeight,cc.ResolutionPolicy.FIXED_HEIGHT):cc.view.setDesignResolutionSize(this._designWidth,this._designHeight,cc.ResolutionPolicy.FIXED_WIDTH)},initSceneSize:function(e,t){if(this._designWidth=e||1136,this._designHeight=t||640,this.initConfigEnd)return;let n=this;cc.view.setResizeCallback(function(){n.resizeScreen(),rich.eventManager.sendEvent("RESIZE_SCREEN")}),this.initConfigEnd=!0,cc.sys.isNative||cc.sys.platform==cc.sys.WECHAT_GAME||"undefined"==typeof wx||this.initWxConfig()},initWxConfig:function(){var e=!1,t=!1,n=function(){t&&e&&(rich.log("\u914d\u7f6e\u5fae\u4fe1\u5206\u4eab"),rich.wxMgr.changeH5ShareConfig(rich.GameConfig.shareTitle,rich.GameConfig.shareContent))};rich.eventManager.addEventListener("WX_SIGN_READY",function(){e=!0,n()},this),rich.eventManager.addEventListener("USER_LOGIN_OK",function(){t=!0,n()},this),rich.eventManager.addEventListener("CONFIG_HALL_SHARE",n,this),rich.wxMgr.getSign()}};rich.sceneManager=rich.sceneManager||sceneManager;let soundManager={musicList:[],effectList:[],btnUrl:null,init:function(){var e=null==cc.sys.localStorage.getItem("musicVolume")?1:cc.sys.localStorage.getItem("musicVolume"),t=null==cc.sys.localStorage.getItem("effectVolume")?1:cc.sys.localStorage.getItem("effectVolume");this.setMusicVolume(e),this.setEffectVolume(t)},setBtnEffectUrl:function(e){this._btnUrl=e},playBtnEffect:function(){this._btnUrl&&this.playEffect(this._btnUrl,!1)},preload:function(e,t){cc.audioEngine.preload(e,t)},setMusicVolume:function(e){for(var t in cc.sys.localStorage.setItem("musicVolume",null==e?1:e),this.musicList){var n=this.musicList[t];cc.audioEngine.setVolume(n,e)}},setEffectVolume:function(e){for(var t in cc.sys.localStorage.setItem("effectVolume",null==e?1:e),this.effectList){var n=this.effectList[t];cc.audioEngine.setVolume(n,e)}},getMusicVolume:function(){var e=null===cc.sys.localStorage.getItem("musicVolume")||""===cc.sys.localStorage.getItem("musicVolume")?1:cc.sys.localStorage.getItem("musicVolume");return Number(e)},getEffectVolume:function(){var e=null===cc.sys.localStorage.getItem("effectVolume")||""===cc.sys.localStorage.getItem("effectVolume")?1:cc.sys.localStorage.getItem("effectVolume");return Number(e)},playMusic:function(e){try{if(!e)return;this.stopAllMusic(),cc.audioEngine.stopAll();let t=this;rich.loaderManager.loadVoice(e.substring(0,e.indexOf(".")),function(e){var n=cc.audioEngine.play(e,!0,t.getMusicVolume());t.musicList.push(n)})}catch(e){}},playMusicWithClip:function(e){try{if(!e)return;this.stopAllMusic();let n=this;var t=cc.audioEngine.play(e,!0,n.getMusicVolume());n.musicList.push(t)}catch(e){}},playEffect:function(e,t){try{if(t=t||!1,!e)return;let n=this;rich.loaderManager.loadVoice(e.substring(0,e.indexOf(".")),function(e){var o=cc.audioEngine.play(e,t,n.getEffectVolume());n.effectList.push(o)})}catch(e){}},playEffectWithClip:function(e,t){try{if(t=t||!1,!e)return;let o=this;var n=cc.audioEngine.play(e,t,o.getEffectVolume());o.effectList.push(n)}catch(e){}},pauseMusic:function(e){try{cc.audioEngine.pause(e)}catch(e){}},pauseEffect:function(e){try{cc.audioEngine.pause(e)}catch(e){}},pauseAllMusic:function(){try{for(var e in this.musicList){var t=this.musicList[e];cc.audioEngine.pause(t)}}catch(e){}},pauseAllEffect:function(){try{for(var e in this.effectList){var t=this.effectList[e];cc.audioEngine.pause(t)}}catch(e){}},stopMusic:function(e){try{cc.audioEngine.stop(e)}catch(e){}},stopEffect:function(e){try{cc.audioEngine.stop(e)}catch(e){}},stopAllMusic:function(){try{for(var e in this.musicList){var t=this.musicList[e];cc.audioEngine.stop(t)}}catch(e){}},stopAllEffect:function(){try{for(var e in this.effectList){var t=this.effectList[e];cc.audioEngine.stop(t)}}catch(e){}},pauseAll:function(){try{cc.audioEngine.pauseAll()}catch(e){}},stopAll:function(){try{cc.audioEngine.stopAll()}catch(e){}}};rich.soundManager=rich.soundManager||soundManager,rich.soundManager.init(),rich.WebSocketType={TOGO:1,TOJAVA:2},rich.WsManager=cc.Class({extends:cc.Component,properties:{websocketPool:null,_wssCer:null},ctor:function(){this.websocketPool={}},initCer:function(e){this._wssCer=e},createWebSocketByType:function(e,t){switch(t=t||rich.WebSocketType.TOGO){case rich.WebSocketType.TOGO:var n=new rich.WebSocketToGo(e);return n.initWithUrl(e,this._wssCer),n;case rich.WebSocketType.TOJAVA:}return null},connect:function(e,t){if(!this.websocketPool[e]||this.websocketPool[e].isClosed()){delete this.websocketPool[e];var n=this.createWebSocketByType(e,t);n.connect(),this.websocketPool[e]=n}else rich.log("\u94fe\u63a5\u5df2\u5b58\u5728",e,this.websocketPool[e]),this.websocketPool[e]._isConnected&&rich.eventManager.sendEvent("WEBSOCKET_CONNECTED",e)},getConnect:function(e){return this.websocketPool[e]},sendMsg:function(e,t,n){var o=this.websocketPool[e];o&&!o.isClosed()?o.sendMsg(t,n):(o&&o.cleanUp(),this.websocketPool[e]=null,rich.log("\u94fe\u63a5\u5df2\u65ad\u5f00"+e),n&&n.failed&&n.failed(-1e3,"\u7f51\u7edc\u5df2\u65ad\u5f00,\u8bf7\u6c42\u5931\u8d25\uff01"),rich.eventManager.sendEvent("WEBSOCKET_CLOSE",e))},sendBinaryMsg:function(e,t,n){var o=this.websocketPool[e];o&&o.sendBinaryMsg(t,n)},close:function(e){var t=this.websocketPool[e];t&&t.close(),this.websocketPool[e]=null},closeAll:function(){for(var e in this.websocketPool){var t=this.websocketPool[e];t&&t.close()}this.websocketPool={}}});let tmxManager={tileMapAssetCache:{},tmxXmlCache:{},tileImageCache:{},tsxXmlCache:{},loadTmx:function(e,t){if(cc.loader.getRes(e)){console.log("\u4ece\u7f13\u5b58\u83b7\u53d6\u5730\u56fe\u8d44\u6e90",e);try{t&&t(void 0,cc.loader.getRes(e))}catch(e){console.log(e)}}else console.log("\u52a0\u8f7d\u65b0\u7684\u5730\u56fe\u8d44\u6e90",e),cc.loader.loadRes(e,cc.TiledMapAsset,function(e,n){try{if(e)return void t(e.message||e);t(void 0,n)}catch(e){console.log(e)}})},loadTmxRemote:function(e,t){if(this.tileMapAssetCache[e])return void t(void 0,this.tileMapAssetCache[e]);let n=this,o=[],i=[],a=[],c=[],r="",s=e.slice(0,e.lastIndexOf("/")+1),l=function(l){r=l;let h=n.parseXml(l);if(h){let l=[],d=[];for(let e=0;e<h.length;e++){let t=h[e];switch(t.type){case 1:l.push(s+t.source);break;case 2:for(let e in t.image)d.push(s+t.image[e])}}console.log("\u52a0\u8f7d\u8fdc\u7a0btsx\u6587\u4ef6"),n.loadTsxRemote(l,function(l,h){if(l)t(l);else{console.log("\u52a0\u8f7d\u8fdc\u7a0btsx\u6587\u4ef6\u6210\u529f");for(let e=0;e<h.length;e++){let t=h[e];if(t){let e=t.name.slice(t.name.lastIndexOf("/")+1);a.push(e);for(let o=0;o<t.relyFiles.length;o++){let e=t.relyFiles[o];switch(e.type){case 1:break;case 2:for(let t in e.image)d.push(s+e.image[t])}}let n=new cc.TextAsset;n.name=e,n.text=t.xml,c.push(n)}}console.log("\u52a0\u8f7d\u56fe\u7247\u8d44\u6e90"),n.loadImagesRemote(d,function(n,s){if(n)console.log("\u52a0\u8f7d\u4f9d\u8d56\u56fe\u7247\u51fa\u9519",n),t(n);else{console.log("\u52a0\u8f7d\u56fe\u7247\u8d44\u6e90\u6210\u529f");for(let e=0;e<s.length;e++){let t=s[e];o.push(t.name.slice(t.name.lastIndexOf("/")+1)),i.push(t.value)}let n=new cc.TiledMapAsset;n.textureNames=o,n.textures=i,n.name=e.slice(e.lastIndexOf("/")+1),n.tmxXmlStr=r,n.tsxFileNames=a,n.tsxFiles=c,t(void 0,n)}})}})}};try{console.log("\u52a0\u8f7dtmx\u6587\u4ef6"),this.tmxXmlCache[e]?l(this.tmxXmlCache[e]):cc.loader.load({url:e,type:"tmx"},function(e,n){e?(console.log("\u52a0\u8f7dtmx\u6587\u4ef6\u5931\u8d25",e),t(e)):(console.log("\u52a0\u8f7dtmx\u6587\u4ef6\u6210\u529f"),l(n))})}catch(e){console.log("\u52a0\u8f7dtmx\u6587\u4ef6\u5931\u8d25",e),t(e)}},loadImagesRemote:function(e,t){let n=this,o=[];if(!e||0==e.length)return void t(void 0,o);let i=[];for(let a in e){let t=e[a];this.tileImageCache[t]?o.push({name:t,value:this.tileImageCache[t]}):i.push(t)}if(i.length>0)try{cc.loader.load(i,function(e,a){if(e)t(e);else{for(let e in i){let t=i[e],c=a.getContent(t);n.tileImageCache[t]=c,o.push({name:t,value:c})}t(void 0,o)}})}catch(e){t(e)}else t(void 0,o)},loadTsxRemote:function(e,t){let n=this,o=[];if(!e||0==e.length)return void t(void 0,o);let i=function(e,t){let i=n.parseXml(t);o.push({name:e,xml:t,relyFiles:i})},a=[];for(let c in e){let t=e[c];this.tsxXmlCache[t]?i(t,this.tsxXmlCache[t]):a.push(t)}if(a.length>0)try{cc.loader.load(a,function(e,c){if(e)t(e);else{for(let e in a){let t=a[e],o=c.getContent(t);n.tsxXmlCache[t]=o,i(t,o)}t(void 0,o)}})}catch(e){t(e)}else t(void 0,o)},parseXml:function(e){var t=(new DOMParser).parseFromString(e,"text/xml").getElementsByTagName("tileset"),n=[];try{if(t)for(var o=0;o<t.length;o++){let e=t[o];if(!e)continue;let c={type:1,des:"\u5916\u90e8\u56fe\u5757",source:"",image:[]};if(e.getAttribute("source"))c.type=1,c.des="\u5916\u90e8\u56fe\u5757",c.source=e.getAttribute("source"),n.push(c);else{var i=e.getElementsByTagName("image");if(i){for(var a=0;a<i.length;a++){let e=i[a];e.getAttribute("source")&&c.image.push(e.getAttribute("source"))}c.type=2,c.des="\u96c6\u6210\u56fe\u5757",n.push(c)}}}}catch(e){console.log("\u89e3\u6790tmx xml\u6587\u4ef6\u5931\u8d25")}return n}};rich.tmxManager=rich.tmxManager||tmxManager,rich.WebSocketToGo=cc.Class({extends:rich.BaseWebSocket,onmessage:function(e){if(rich.BaseWebSocket.prototype.onmessage.call(this),-1!=e.data.indexOf("go-websocket-message:m;"))for(var t=e.data.split("go-websocket-message:m;"),n=0;n<t.length;n++){var o=t[n].split(";");o.length>1&&this.parseMsg(o[1])}else this.parseMsg(e.data)},parseMsg:function(e){var t=rich.base64.decode(e),n=rich.json.decode(t);if(n){"Echo"!=n.method&&rich.log("\u6536\u5230\u6570\u636e",t);var o=null,i=null;n.error&&n.error>0?(o="failed",i=n):(o="succuss",i=n),this.excuteCallback(n.method,o,i),n.custom||(rich.log("\u670d\u52a1\u7aef\u63a8\u9001",n.method),rich.eventManager.sendEvent(n.method,n))}else rich.log("\u89e3\u6790\u6570\u636e\u5931\u8d25",t,e)},ping:function(){rich.BaseWebSocket.prototype.ping.call(this);var e=(new Date).getTime(),t=this;rich.handlerManager.doGoSocketHandler(this._url,{method:"Echo"},function(){var n=(new Date).getTime();t._pingTime=n-e},null)}}),rich.physics_bound=cc.Class({extends:cc.Component,properties:{size:cc.size(0,0),mouseJoint:!0},onLoad:function(){let e=this.size.width||this.node.width,t=this.size.height||this.node.height,n=new cc.Node;n.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static,this.mouseJoint&&(n.addComponent(cc.MouseJoint).mouseRegion=this.node),this._addBound(n,0,t/2,e,20),this._addBound(n,0,-t/2,e,20),this._addBound(n,-e/2,0,20,t),this._addBound(n,e/2,0,20,t),n.parent=this.node},_addBound(e,t,n,o,i){let a=e.addComponent(cc.PhysicsBoxCollider);a.offset.x=t,a.offset.y=n,a.size.width=o,a.size.height=i}});let physicsMgr={enablePhysics:function(e){cc.director.getPhysicsManager().enabled=!0,e&&this.openDebugPhysicsDraw(),cc.systemEvent.emit("ENABLE_PHYSICS")},disablePhysics:function(){cc.director.getPhysicsManager().enabled=!1,cc.systemEvent.emit("DISABLE_PHYSICS")},openDebugPhysicsDraw:function(){cc.director.getPhysicsManager().enabled&&(cc.director.getPhysicsManager().debugDrawFlags=cc.PhysicsManager.DrawBits.e_aabbBit|cc.PhysicsManager.DrawBits.e_pairBit|cc.PhysicsManager.DrawBits.e_centerOfMassBit|cc.PhysicsManager.DrawBits.e_jointBit|cc.PhysicsManager.DrawBits.e_shapeBit)},closeDebugPhysicsDraw:function(){cc.director.getPhysicsManager().enabled&&(cc.director.getPhysicsManager().debugDrawFlags=0)},addScreenGround:function(){let e=cc.winSize.width,t=cc.winSize.height,n=new cc.Node;n.group="ground",n.parent=cc.director.getScene(),n.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static,this.addBound(n,0,t/2,20,t),this.addBound(n,e,t/2,20,t),this.addBound(n,e/2,t,e,20),this.addBound(n,e/2,0,e,20)},addBoundsForNode:function(e){let t=e.width,n=e.height,o=new cc.Node;o.group="ground",o.parent=e,o.addComponent(cc.RigidBody).type=cc.RigidBodyType.Static,this.addBound(o,0,n/2,10,n),this.addBound(o,t,n/2,10,n),this.addBound(o,t/2,n,t,10),this.addBound(o,t/2,0,t,10)},addBound(e,t,n,o,i){let a=e.addComponent(cc.PhysicsBoxCollider);a.offset.x=t,a.offset.y=n,a.size.width=o,a.size.height=i,a.apply()}};rich.physicsMgr=rich.physicsMgr||physicsMgr;let alert={show:function(e,t,n,o){rich.prefabManager.loadPrefab("richkit/Dialog",function(i){var a=cc.instantiate(i);if(a){let i=rich.sceneManager.getPersistRootNode();i?rich.prefabManager.addPrefabToNode(i,a,function(i){var a=i.getComponent(rich.Dialog);a&&a.showTips(e,t,n,o)}):rich.prefabManager.addPrefabToScene(a,function(i){var a=i.getComponent(rich.Dialog);a&&a.showTips(e,t,n,o)})}else rich.log("\u521d\u59cb\u5316\u5931\u8d25")})},showToScene:function(e,t,n,o){rich.prefabManager.loadPrefab("richkit/Dialog",function(i){var a=cc.instantiate(i);a?rich.prefabManager.addPrefabToScene(a,function(i){var a=i.getComponent(rich.Dialog);a&&a.showTips(e,t,n,o)}):rich.log("\u521d\u59cb\u5316\u5931\u8d25")})},showError:function(e,t,n){var o="\u672a\u5b9a\u4e49\u9519\u8bef\u7801"+e;t&&(o=t),this.show(o,n)},showFlyTip:function(e){var t=new cc.Node,n=t.addComponent(cc.Label);n.fontSize=30,n.lineHeight=40,t.color=cc.color(255,255,255),t.setAnchorPoint(cc.v2(.5,.5)),n.string=e||"";let o=rich.sceneManager.getPersistRootNode();o||(o=cc.director.getScene()),t.parent=o,t.x=cc.winSize.width/2,t.y=cc.winSize.height/2,cc.Tween.stopAllByTarget(t),cc.tween(t).to(.6,{position:cc.v2(cc.winSize.width/2,cc.winSize.height/2+100)}).delay(.3).call(function(){t.destroy()}).start()}};rich.alert=rich.alert||alert;let arrayTool={containsObj:function(e,t){if(!e)return!1;for(var n=e.length;n--;)if(e[n]==t)return!0;return!1},removeObj:function(e,t){for(var n=e.length;n--;)if(e[n]==t)return e.splice(n,1);return-1}};function base64encode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var n,o,i,a,c,r;for(i=e.length,o=0,n="";o<i;){if(a=255&e.charCodeAt(o++),o==i){n+=t.charAt(a>>2),n+=t.charAt((3&a)<<4),n+="==";break}if(c=e.charCodeAt(o++),o==i){n+=t.charAt(a>>2),n+=t.charAt((3&a)<<4|(240&c)>>4),n+=t.charAt((15&c)<<2),n+="=";break}r=e.charCodeAt(o++),n+=t.charAt(a>>2),n+=t.charAt((3&a)<<4|(240&c)>>4),n+=t.charAt((15&c)<<2|(192&r)>>6),n+=t.charAt(63&r)}return n}function base64decode(e){let t=new Array(-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1);var n,o,i,a,c,r,s;for(r=e.length,c=0,s="";c<r;){do{n=t[255&e.charCodeAt(c++)]}while(c<r&&-1==n);if(-1==n)break;do{o=t[255&e.charCodeAt(c++)]}while(c<r&&-1==o);if(-1==o)break;s+=String.fromCharCode(n<<2|(48&o)>>4);do{if(61==(i=255&e.charCodeAt(c++)))return s;i=t[i]}while(c<r&&-1==i);if(-1==i)break;s+=String.fromCharCode((15&o)<<4|(60&i)>>2);do{if(61==(a=255&e.charCodeAt(c++)))return s;a=t[a]}while(c<r&&-1==a);if(-1==a)break;s+=String.fromCharCode((3&i)<<6|a)}return s}function utf16to8(e){var t,n,o,i;for(t="",o=e.length,n=0;n<o;n++)(i=e.charCodeAt(n))>=1&&i<=127?t+=e.charAt(n):i>2047?(t+=String.fromCharCode(224|i>>12&15),t+=String.fromCharCode(128|i>>6&63),t+=String.fromCharCode(128|i>>0&63)):(t+=String.fromCharCode(192|i>>6&31),t+=String.fromCharCode(128|i>>0&63));return t}function utf8to16(e){var t,n,o,i,a,c;for(t="",o=e.length,n=0;n<o;)switch((i=e.charCodeAt(n++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=e.charAt(n-1);break;case 12:case 13:a=e.charCodeAt(n++),t+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=e.charCodeAt(n++),c=e.charCodeAt(n++),t+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&c)<<0)}return t}function CharToHex(e){var t,n,o,i;for(t="",o=e.length,n=0;n<o;)(i=e.charCodeAt(n++).toString(16)).length<2&&(i="0"+i),t+="\\x"+i+" ",n>0&&n%8==0&&(t+="\r\n");return t}function encode(e){return base64encode(utf16to8(e))}function decode(e){return utf8to16(base64decode(e))}rich.arrayTool=rich.arrayTool||arrayTool;let base64={encode:function(e){return encode(e)},decode:function(e){return decode(e)}};rich.base64=rich.base64||base64,Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};let json={encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}};rich.json=rich.json||json;let mathTools={degreeToRadian:function(e){return e*Math.PI/180},radianToDegree:function(e){return 180*e/Math.PI},vToAngle:function(e){var t=Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));if(0==t)return 0;var n=e.x/t,o=Math.acos(n);if(0==o)return 0;var i=180/(Math.PI/o);return e.y<0?i=360-i:0==e.y&&e.x<0&&(i=180),i},isNaN:function(e){return e!=e},isInfinity:function(e){return e+1==e},isValidNumber:function(e){return!(isNaN(e)||isInfinity(e))},random:function(e,t){return e>t&&(t=e),Math.floor(Math.random()*(t-e))+e},toNumber:function(e){return isNaN||Number(e),0}};rich.mathTools=rich.mathTools||mathTools;let md5={encode:function(e){var t=0,n=8;function o(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,o=-271733879,i=-1732584194,h=271733878,d=0;d<e.length;d+=16){var u=n,g=o,f=i,p=h;o=s(o=s(o=s(o=s(o=r(o=r(o=r(o=r(o=c(o=c(o=c(o=c(o=a(o=a(o=a(o=a(o,i=a(i,h=a(h,n=a(n,o,i,h,e[d+0],7,-680876936),o,i,e[d+1],12,-389564586),n,o,e[d+2],17,606105819),h,n,e[d+3],22,-1044525330),i=a(i,h=a(h,n=a(n,o,i,h,e[d+4],7,-176418897),o,i,e[d+5],12,1200080426),n,o,e[d+6],17,-1473231341),h,n,e[d+7],22,-45705983),i=a(i,h=a(h,n=a(n,o,i,h,e[d+8],7,1770035416),o,i,e[d+9],12,-1958414417),n,o,e[d+10],17,-42063),h,n,e[d+11],22,-1990404162),i=a(i,h=a(h,n=a(n,o,i,h,e[d+12],7,1804603682),o,i,e[d+13],12,-40341101),n,o,e[d+14],17,-1502002290),h,n,e[d+15],22,1236535329),i=c(i,h=c(h,n=c(n,o,i,h,e[d+1],5,-165796510),o,i,e[d+6],9,-1069501632),n,o,e[d+11],14,643717713),h,n,e[d+0],20,-373897302),i=c(i,h=c(h,n=c(n,o,i,h,e[d+5],5,-701558691),o,i,e[d+10],9,38016083),n,o,e[d+15],14,-660478335),h,n,e[d+4],20,-405537848),i=c(i,h=c(h,n=c(n,o,i,h,e[d+9],5,568446438),o,i,e[d+14],9,-1019803690),n,o,e[d+3],14,-187363961),h,n,e[d+8],20,1163531501),i=c(i,h=c(h,n=c(n,o,i,h,e[d+13],5,-1444681467),o,i,e[d+2],9,-51403784),n,o,e[d+7],14,1735328473),h,n,e[d+12],20,-1926607734),i=r(i,h=r(h,n=r(n,o,i,h,e[d+5],4,-378558),o,i,e[d+8],11,-2022574463),n,o,e[d+11],16,1839030562),h,n,e[d+14],23,-35309556),i=r(i,h=r(h,n=r(n,o,i,h,e[d+1],4,-1530992060),o,i,e[d+4],11,1272893353),n,o,e[d+7],16,-155497632),h,n,e[d+10],23,-1094730640),i=r(i,h=r(h,n=r(n,o,i,h,e[d+13],4,681279174),o,i,e[d+0],11,-358537222),n,o,e[d+3],16,-722521979),h,n,e[d+6],23,76029189),i=r(i,h=r(h,n=r(n,o,i,h,e[d+9],4,-640364487),o,i,e[d+12],11,-421815835),n,o,e[d+15],16,530742520),h,n,e[d+2],23,-995338651),i=s(i,h=s(h,n=s(n,o,i,h,e[d+0],6,-198630844),o,i,e[d+7],10,1126891415),n,o,e[d+14],15,-1416354905),h,n,e[d+5],21,-57434055),i=s(i,h=s(h,n=s(n,o,i,h,e[d+12],6,1700485571),o,i,e[d+3],10,-1894986606),n,o,e[d+10],15,-1051523),h,n,e[d+1],21,-2054922799),i=s(i,h=s(h,n=s(n,o,i,h,e[d+8],6,1873313359),o,i,e[d+15],10,-30611744),n,o,e[d+6],15,-1560198380),h,n,e[d+13],21,1309151649),i=s(i,h=s(h,n=s(n,o,i,h,e[d+4],6,-145523070),o,i,e[d+11],10,-1120210379),n,o,e[d+2],15,718787259),h,n,e[d+9],21,-343485551),n=l(n,u),o=l(o,g),i=l(i,f),h=l(h,p)}return Array(n,o,i,h)}function i(e,t,n,o,i,a){return l((c=l(l(t,e),l(o,a)))<<(r=i)|c>>>32-r,n);var c,r}function a(e,t,n,o,a,c,r){return i(t&n|~t&o,e,t,a,c,r)}function c(e,t,n,o,a,c,r){return i(t&o|n&~o,e,t,a,c,r)}function r(e,t,n,o,a,c,r){return i(t^n^o,e,t,a,c,r)}function s(e,t,n,o,a,c,r){return i(n^(t|~o),e,t,a,c,r)}function l(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function h(e){for(var t=Array(),o=(1<<n)-1,i=0;i<e.length*n;i+=n)t[i>>5]|=(e.charCodeAt(i/n)&o)<<i%32;return t}function d(e){for(var n=t?"0123456789ABCDEF":"0123456789abcdef",o="",i=0;i<4*e.length;i++)o+=n.charAt(e[i>>2]>>i%4*8+4&15)+n.charAt(e[i>>2]>>i%4*8&15);return o}return function(e){return d(o(h(e),e.length*n))}(e)}};rich.md5=rich.md5||md5,String.prototype.format=function(e){var t=this;if(arguments.length>0)if(1==arguments.length&&"object"==typeof e){for(var n in e)if(null!=e[n]){var o=new RegExp("({"+n+"})","g");t=t.replace(o,e[n])}}else for(var i=0;i<arguments.length;i++)null!=arguments[i]&&(o=new RegExp("({)"+i+"(})","g"),t=t.replace(o,arguments[i]));return t};let tools={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e))+e},getObjectPropLength:function(e){return"object"!=typeof e?0:Object.keys(e).length},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},numberFormat1:function(e,t){if(t=t||",",!e)return"0";for(var n="",o=e;o>0;){var i=o%1e3;n=(o=Math.floor(o/1e3))>0?t+(i>99?i.toString():i>9?"0"+i:"00"+i)+n:i.toString()+n}return n},chipFormat1:function(e){return e>=1e9?(Math.floor(e/1e7)/100).toFixed(2)+"B":e>=1e6?(Math.floor(e/1e4)/100).toFixed(2)+"M":e>=1e4?(Math.floor(e/10)/100).toFixed(2)+"K":e},timeFormat1:function(e,t){if(t=t||":",!e)return"00:00:00";var n="",o=Math.floor(e)%60,i=Math.floor(e/60)%60,a=Math.floor(e/3600)%60;return n+=a>9?a.toString():"0"+a,n+=t,n+=i>9?i.toString():"0"+i,(n+=t)+(o>9?o.toString():"0"+o)},timeFormat3:function(e,t){if(t=t||":","number"!=typeof e)return"00:00";var n="",o=Math.floor(e)%60,i=Math.floor(e/60)%60;return n+=i>9?i.toString():"0"+i,(n+=t)+(o>9?o.toString():"0"+o)},timeFormat4:function(e,t){if(t=t||":",!e||"number"!=typeof e)return"00:00:00";var n=Math.floor(e/1e3),o=Math.floor(e/10)%100,i="",a=Math.floor(n)%60,c=Math.floor(n/60)%60;return i+=c>9?c.toString():"0"+c,i+=t,i+=a>9?a.toString():"0"+a,(i+=t)+(o>9?o.toString():"0"+o)},openUrl:function(e){cc.sys.isNative?cc.sys.openURL(e):window.location.href=e},endGame:function(){cc.sys.isNative?cc.director.end():(window.opener=null,window.open("","_self"),window.close())},xorEncrypt:function(e,t){for(var n="",o=0;o<t.length;o++){var i=t.charCodeAt(o)^e;n+=String.fromCharCode(i)}return n},isCardNo:function(e){return!1!==/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)},isRealName:function(e){return!!/^[\u4e00-\u9fa5]{2,4}$/.test(e)},copyH5TextToClipBoard:function(e){if(cc.sys.isNative)return;var t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.contain="strict",t.style.position="absolute",t.style.left="-9999px",t.style.fontSize="12pt";const n=getSelection();var o=!1;n.rangeCount>0&&(o=n.getRangeAt(0)),document.body.appendChild(t),t.select(),t.selectionStart=0,t.selectionEnd=e.length;var i=!1;try{i=document.execCommand("copy")}catch(e){}return document.body.removeChild(t),o&&(n.removeAllRanges(),n.addRange(o)),i},captureScreen(e,t){let n=new cc.RenderTexture,o=cc.game._renderContext;n.initWithSize(cc.winSize.width,cc.winSize.height,o.STENCIL_INDEX8),e.targetTexture=n,e.render();let i=n.readPixels(),a=n.width,c=n.height;if(cc.sys.isNative);else{this._canvas?this._canvas.getContext("2d").clearRect(0,0,this._canvas.width,this._canvas.height):(this._canvas=document.createElement("canvas"),this._canvas.width=a,this._canvas.height=c);let e=this._canvas.getContext("2d"),n=4*a;for(let t=0;t<c;t++){let o=c-1-t,r=e.createImageData(a,1),s=o*a*4;for(let e=0;e<n;e++)r.data[e]=i[s+e];e.putImageData(r,0,t)}var r=this._canvas.toDataURL("image/png"),s=document.createElement("img");s.src=r;let o=new cc.Texture2D;o.initWithElement(s),t&&t("result_share.jpg",o)}},strClamp(e,t,n){n=null==n?"...":n,t*=2;for(var o=function(e){for(var t=[],n=0,o=0,i=0;i<e.length;){var a=i;if(65039!=(n=e.charCodeAt(i++)))if(o){var c=65536+(o-55296<<10)+(n-56320);t.push({v:c,pos:a}),o=0}else 55296<=n&&n<=56319?o=n:t.push({v:n,pos:a})}return t}(e),i=0,a=0,c=0;c<o.length;++c){var r=1;if(o[c].v>=128&&(r=2),i+r>t)break;a=c,i+=r}if(o.length-1==a)return e;var s=n?1:0;return e.substring(0,o[a-s].pos+1)+n}};rich.tools=rich.tools||tools;let utils={setNodeOpacityMask:function(e,t){t=t||125,e.addComponent(rich.OpacityMask).setOpacity(t)},setNodeTouchMask:function(e,t){e.addComponent(rich.TouchMask).removeWhenTouch=t},addPageEvent:function(e,t,n,o){let i=e.getComponent(cc.PageView);if(i||(i=e.addComponent(cc.PageView)),o){var a=new cc.Component.EventHandler;a.target=t,a.component=n,a.handler=o,i.pageEvents.push(a)}},addClickEvent:function(e,t,n,o,i){null==i&&(i=cc.Button.Transition.SCALE);let a=e.getComponent(cc.Button);if(a||(a=e.addComponent(cc.Button)),a.enableAutoGrayEffect=!0,a.transition=i,a.duration=.1,a.zoomScale=1.05,o){var c=new cc.Component.EventHandler;c.target=t,c.component=n,c.handler=o,a.clickEvents.push(c)}},addCheckEvent:function(e,t,n,o){let i=e.getComponent(cc.Toggle);if(i&&o){var a=new cc.Component.EventHandler;a.target=t,a.component=n,a.handler=o,i.checkEvents.push(a)}},addSlideEvent:function(e,t,n,o){var i=new cc.Component.EventHandler;i.target=t,i.component=n,i.handler=o,e.getComponent(cc.Slider).slideEvents.push(i)},addEscEvent:function(e){cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(){},onKeyReleased:function(e){e==cc.KEY.back&&rich.alert.show("\u63d0\u793a","\u786e\u5b9a\u8981\u9000\u51fa\u6e38\u620f\u5417\uff1f",function(){cc.game.end()},!0)}},e)},setFitSreenMode:function(){var e=cc.find("Canvas"),t=cc.view.getFrameSize(),n=t.width,o=t.height,i=e.getComponent(cc.Canvas);n/o>i.designResolution.width/i.designResolution.height?(i.fitHeight=!0,i.fitWidth=!1):(i.fitHeight=!1,i.fitWidth=!0)},loadSubPackage:function(e,t){rich.log("\u5f00\u59cb\u52a0\u8f7d\u5b50\u5305===",e),cc.loader.downloader.loadSubpackage(e,function(e){try{t&&(t(e),e?rich.log("\u52a0\u8f7d\u5b50\u5305\u51fa\u9519",e):rich.log("\u52a0\u8f7d\u5b50\u5305\u6210\u529f"))}catch(e){rich.log("\u52a0\u8f7d\u5b50\u5305\u51fa\u9519",e)}})},formatUrlParams:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.push(("v="+Math.random()).replace(".","")),t.join("&")},parseUrlParams:function(e){var t,n,o={};if(null==e)return o;for(var i=e,a=i.indexOf("?"),c=(i=i.substr(a+1)).split("&"),r=0;r<c.length;r++)(a=c[r].indexOf("="))>0&&(t=c[r].substring(0,a),n=c[r].substr(a+1),o[t]=decodeURIComponent(n));return o},addGetters:function(e){let t=e.__values__;for(let n in t){let o=t[n];e.prototype.__defineGetter__(o,function(){return this[`_${o}`]})}},addSetters:function(e){let t=e.__values__;for(let n in t){let o=t[n];e.prototype.__defineSetter__(o,function(e){this[`_${o}`]=e,this.emit&&this._callbackTable&&this.emit(`on_${o}`,e)})}}};rich.utils=rich.utils||utils;let StyleTool={parseToStyle(e,t,n,o,i,a){let c={};return c.color=e,c.size=t,c.outline=n,c.b=o,c.i=i,c.u=a,c},initWithStyleId(e,t){let n=_G.D.get(_G.D.cfg_styles,_G.cfg_keys.cfg_style.id,e);return n?this.initWithStyle(n,t):t},initWithStyle:(e,t)=>t?e?(e.color&&(t=`<color=${e.color}>${t}</color>`),e.size&&(t=`<size=${e.size}>${t}</size>`),e.outline&&(t=`<outline color=${e.outline[0]||"#ffffff"} width=${e.outline[1]||1}>${t}</outline>`),e.b&&(t=`<b>${t}</b>`),e.i&&(t=`<i>${t}</i>`),e.u&&(t=`<u>${t}</u>`),t):t:""};rich.styleTool=rich.styleTool||StyleTool,rich.ChooseOption=cc.Class({extends:cc.Component,name:"ChooseOption",editor:{executeInEditMode:!1,requireComponent:null,executionOrder:0,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/ChooseOption",playOnFocus:!1,inspector:"",icon:"",help:""},properties:()=>({chooseIdx:{tooltip:"\u5f53\u524d\u9009\u62e9\u4e0b\u6807",default:0,notify:function(e){this.chooseIdx>=this.node.children.length&&(this.chooseIdx=e,cc.error("\u9009\u62e9\u4e0b\u6807\u4e0d\u80fd\u9ad8\u4e8e\u8282\u70b9\u6570\u91cf")),this._updateNodes(),this._updateAffect()}}}),onLoad:function(){this._updateNodes(),this._updateAffect()},_updateAffect:function(){let e=this.node.getComponents("ChooseOptionLink");if(e)for(let t in e){let n=e[t];if(n.linkTarget&&n.affectLinkParams&&n.affectLinkParams.length>0){let e=n.linkTarget.getComponent("ChooseOption");if(e)for(let t in n.affectLinkParams){let o=n.affectLinkParams[t];o.curIdx==this.chooseIdx&&(e.chooseIdx=o.affectLinkIdx)}}}},_updateNodes:function(){let e=this.node.children;for(let t in e){let n=e[t];n&&(t==this.chooseIdx?n.active=!0:n.active=!1)}}}),rich.RepeatChildren=cc.Class({extends:cc.Component,name:"RepeatChildren",editor:{executeInEditMode:!1,requireComponent:null,executionOrder:0,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/RepeatChildren",playOnFocus:!1,inspector:"",icon:"",help:""},properties:()=>({repeatSpeed:1,_pause:!1,_contentHeight:0,_eventHander:null,_eventTarget:null,_needRindex:!1}),onLoad:function(){let e=0,t=this.node.children.length;for(let n=0;n<this.node.children.length;n++){let o=this.node.children[n];o.y=e,o.zIndex=t-n,o.needReset=!1,e+=o.height}this._contentHeight=e,this._pause=!0},begin:function(){this._pause=!1,rich.log("\u5f00\u59cb\u6eda\u52a8")},stop:function(){this._pause=!0,rich.log("\u505c\u6b62\u6eda\u52a8")},registEvent:function(e,t){this._eventHander=e,this._eventTarget=t},update:function(e){if(this._pause)return;let t=!1;this._needRindex&&(t=!0,this._needRindex=!1);for(let n=0;n<this.node.children.length;n++){let o=this.node.children[n];o.y-=60*this.repeatSpeed*e,t&&(o.zIndex++,o.needReset&&(o.zIndex=1,o.needReset=!1)),o.y<-o.height&&(o.y+=this._contentHeight,o.needReset=!0,this._needRindex=!0,this._eventHander&&"function"==typeof this._eventHander&&this._eventHander.call(this._eventTarget,o))}}}),rich.HotUpdate=cc.Class({extends:cc.Component,name:"HotUpdate",editor:{executeInEditMode:!1,requireComponent:null,executionOrder:0,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/HotUpdate",playOnFocus:!1,inspector:"",icon:"",help:""},properties:{_updating:!1,_canRetry:!1,_storagePath:"",_beginCallback:null,_endCallback:null,_errorCallback:null,_progressCallback:null},setHotUpdateParams:function(e,t,n,o,i){this.manifestUrl=e,this._beginCallback=t,this._progressCallback=n,this._endCallback=o,this._errorCallback=i,this.prepare()},prepare:function(){cc.sys.isNative?(this._storagePath=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+"remote-assets",rich.log("Storage path for remote asset : "+this._storagePath),this.versionCompareHandle=function(e,t){rich.log("JS Custom Version Compare: version A is "+e+", version B is "+t);for(var n=e.split("."),o=t.split("."),i=0;i<n.length;++i){var a=parseInt(n[i]),c=parseInt(o[i]||0);if(a!==c)return a-c}return o.length>n.length?-1:0},this._am=new jsb.AssetsManager("",this._storagePath,this.versionCompareHandle),this._am.setVerifyCallback(function(e,t){var n=t.compressed,o=t.md5,i=t.path;return t.size,n?(rich.log("Verification passed : "+i),!0):(rich.log("Verification passed : "+i+" ("+o+")"),!0)}),rich.log("Hot update is ready, please check or directly update."),cc.sys.os===cc.sys.OS_ANDROID&&(this._am.setMaxConcurrentTask(2),rich.log("Max concurrent tasks count have been limited to 2")),this.checkUpdate()):this.updateEnd()},updateBegin:function(e){try{this._beginCallback&&this._beginCallback(e)}catch(e){}},updateProgress:function(e,t){try{this._progressCallback&&this._progressCallback(e,t)}catch(e){}},updateEnd:function(){try{this._endCallback&&this._endCallback()}catch(e){}},updateError:function(e){try{this._errorCallback&&this._errorCallback(e)}catch(e){}},checkCb:function(e){var t=!1,n=!1,o="";switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:rich.log("No local manifest file found, hot update skipped."),n=!0,o="No local manifest file found, hot update skipped";break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:rich.log("Fail to download manifest file, hot update skipped."),n=!0,o="Fail to download manifest file, hot update skipped";break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:rich.log("Already up to date with the latest remote version.");break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:rich.log("New version found, please try to update."),this.updateBegin(e.getTotalBytes()),t=!0;break;default:return}this._am.setEventCallback(null),this._checkListener=null,this._updating=!1,t?this.hotUpdate():n?this.updateError(o):this.updateEnd()},updateCb:function(e){var t=!1,n=!1;switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:rich.log("No local manifest file found, hot update skipped."),n=!0;break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:this.updateProgress(e.getDownloadedBytes(),e.getTotalBytes()),rich.log("loading==",e.getDownloadedFiles()+" / "+e.getTotalFiles()),rich.log("loading==",e.getDownloadedBytes()+" / "+e.getTotalBytes());var o=e.getMessage();o&&rich.log("Updated file: ",e.getPercent()/100+"% : "+o);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:rich.log("Fail to download manifest file, hot update skipped."),n=!0;break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:rich.log("Already up to date with the latest remote version."),n=!0;break;case jsb.EventAssetsManager.UPDATE_FINISHED:rich.log("Update finished. "+e.getMessage()),t=!0;break;case jsb.EventAssetsManager.UPDATE_FAILED:rich.log("Update failed. "+e.getMessage()),this._updating=!1,this._canRetry=!0;break;case jsb.EventAssetsManager.ERROR_UPDATING:rich.log("Asset update error: "+e.getAssetId()+", "+e.getMessage());break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:rich.log(e.getMessage())}if(n&&(this._am.setEventCallback(null),this._updateListener=null,this._updating=!1),t){this._am.setEventCallback(null),this._updateListener=null;var i=jsb.fileUtils.getSearchPaths(),a=this._am.getLocalManifest().getSearchPaths();console.log(JSON.stringify(a)),Array.prototype.unshift(i,a),cc.sys.localStorage.setItem("HotUpdateSearchPaths",JSON.stringify(i)),jsb.fileUtils.setSearchPaths(i),cc.audioEngine.stopAll(),cc.game.restart()}this._updating||(this._canRetry?this.retry():this.updateEnd())},retry:function(){!this._updating&&this._canRetry&&(this._canRetry=!1,rich.log("Retry failed Assets..."),this._am.downloadFailedAssets())},checkUpdate:function(){if(this._updating)rich.log("Checking or updating ...");else{if(this._am.getState()===jsb.AssetsManager.State.UNINITED){var e=this.manifestUrl.nativeUrl;rich.log("nativeUrl1===",e),cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e)),rich.log("nativeUrl2===",e),this._am.loadLocalManifest(e)}if(!this._am.getLocalManifest()||!this._am.getLocalManifest().isLoaded())return rich.log("Failed to load local manifest ..."),void this.updateError("Failed to load local manifest");this._am.setEventCallback(this.checkCb.bind(this)),this._am.checkUpdate(),this._updating=!0}},hotUpdate:function(){if(this._am&&!this._updating){if(this._am.setEventCallback(this.updateCb.bind(this)),this._am.getState()===jsb.AssetsManager.State.UNINITED){var e=this.manifestUrl.nativeUrl;rich.log("nativeUrl1===",e),cc.loader.md5Pipe&&(e=cc.loader.md5Pipe.transformURL(e)),rich.log("nativeUrl2===",e),this._am.loadLocalManifest(e)}this._failCount=0,this._am.update(),this._updating=!0}},onDestroy:function(){this._updateListener&&(this._am.setEventCallback(null),this._updateListener=null)}}),rich.Dialog=cc.Class({extends:rich.NodeBase,name:"Dialog",editor:{executeInEditMode:!1,requireComponent:null,executionOrder:0,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/Dialog",playOnFocus:!1,inspector:"",icon:"",help:""},properties:()=>({}),onCreate:function(){rich.utils.setNodeTouchMask(this.node),rich.utils.setNodeOpacityMask(this.node,125)},showTips:function(e,t,n,o){this._animSpeed=o||.2;let i=this.lbt_content.getComponent(rich.LabelLocalized);i?i.textKey=e:this.lbt_content.string=e,t&&(this._confirm=t),n?(this.btn_cancel.node.active=!0,this._cancel=n):(this.btn_cancel.node.active=!1,this.btn_confirm.node.x=0),this.showIn()},press_confirm:function(){this._confirm&&this._confirm(),this.showOut()},press_cancel:function(){this._cancel&&this._cancel(),this.showOut()},showIn:function(){var e=this;this.node.opacity=0,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(0,{scale:2}).to(this._animSpeed,{opacity:255,scale:1}).call(function(){e.showInEnd()}).start()},showInEnd:function(){},showOut:function(){var e=this;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(this._animSpeed,{opacity:0,scale:2}).call(function(){e.showOutEnd(),e.node.destroy()}).start()},showOutEnd:function(){}}),rich.PopUpComponent=cc.Class({extends:cc.Component,name:"PopUpComponent",editor:{executeInEditMode:!1,requireComponent:null,executionOrder:0,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/PopUpComponent",playOnFocus:!1,inspector:"",icon:"",help:""},properties:()=>({isShowIn:{tooltip:"\u662f\u5426\u6253\u5f00\u7684\u65f6\u5019\u6de1\u5165",default:!0},showInTime:{tooltip:"\u6de1\u5165\u65f6\u95f4",default:.3},showOutTime:{tooltip:"\u6de1\u51fa\u65f6\u95f4",default:.3}}),onLoad:function(){var e=this;rich.eventManager.addEventListener("RESIZE_SCREEN",function(){e.node&&(e.node.x=cc.winSize.width/2,e.node.y=cc.winSize.height/2)},this),this.isShowIn&&this.showIn()},showIn:function(){var e=this;this.node.opacity=0,cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(0,{scale:2}).to(this.showInTime,{opacity:255,scale:1}).call(function(){e.showInEnd()}).start()},showInEnd:function(){for(let e in this.node._components){let t=this.node._components[e];t instanceof rich.PopUpComponent||!t.showInEnd||t.showInEnd.call(this)}},showOut:function(){var e=this;cc.Tween.stopAllByTarget(this.node),cc.tween(this.node).to(this.showOutTime,{opacity:0,scale:2}).call(function(){e.showOutEnd(),e.node.destroy()}).start()},showOutEnd:function(){for(let e in this.node._components){let t=this.node._components[e];t instanceof rich.PopUpComponent||!t.showOutEnd||t.showOutEnd.call(this)}},close:function(){this.showOut()},onDestroy(){rich.eventManager.removeEventListenerByTarget(this)}}),rich.RichTextExt=cc.Class({extends:cc.Component,name:"RichTextExt",editor:{executeInEditMode:!0,requireComponent:cc.RichText,executionOrder:1,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/RichTextExt",playOnFocus:!1,inspector:"",icon:"",help:""},properties:{string:{default:"",multiline:!0,tooltip:"\u8f93\u5165\u5e26style\u7684\u5bcc\u6587\u672c",notify:function(){this.changeStr()}}},onLoad(){this.string&&this.changeStr()},changeStr(){let e=this.node.getComponent(cc.RichText);if(e){let t=this.parseString(this.string);e.string=t}},parseStyle(e){if(!e)return"";let t=e.indexOf("<style=")+7,n=e.indexOf(">"),o=Number(e.substr(t,n-t)),i=e.substr(n+1,e.indexOf("</style>")-(n+1));return rich.styleTool.initWithStyleId(o,i)},parseString(e){let t="",n=e;for(;n.indexOf("<style=")>=0&&n.indexOf("</style>")>=0;){t+=n.substr(0,n.indexOf("<style="));let e=n.substr(n.indexOf("<style="),n.indexOf("</style>")+8-n.indexOf("<style="));t+=this.parseStyle(e),n=n.substr(n.indexOf("</style>")+8)}return t+n}});let i18n={polyglot:null,initPolyglot:function(){this.polyglot||(this.polyglot=new Polyglot({phrases:{},allowMissing:!0}))},init(e){this.polyglot||this.initPolyglot(),this.polyglot.replace(e),cc.systemEvent.emit("CHANGE_LANGUAGE")},t(e,t){return this.polyglot||this.initPolyglot(),this.polyglot.t(e,t)}};rich.i18n=rich.i18n||i18n;var replace=String.prototype.replace;function Polyglot(e){e=e||{},this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en",this.allowMissing=!!e.allowMissing,this.warn=e.warn||warn}Polyglot.VERSION="1.0.0",Polyglot.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},Polyglot.prototype.extend=function(e,t){var n;for(var o in e)e.hasOwnProperty(o)&&(n=e[o],t&&(o=t+"."+o),"object"==typeof n?this.extend(n,o):this.phrases[o]=n)},Polyglot.prototype.unset=function(e,t){var n;if("string"==typeof e)delete this.phrases[e];else for(var o in e)e.hasOwnProperty(o)&&(n=e[o],t&&(o=t+"."+o),"object"==typeof n?this.unset(n,o):delete this.phrases[o])},Polyglot.prototype.clear=function(){this.phrases={}},Polyglot.prototype.replace=function(e){this.clear(),this.extend(e)},Polyglot.prototype.t=function(e,t){var n,o;return"number"==typeof(t=null==t?{}:t)&&(t={smart_count:t}),"string"==typeof this.phrases[e]?n=this.phrases[e]:"string"==typeof t._?n=t._:this.allowMissing?n=e:(this.warn('Missing translation for key: "'+e+'"'),o=e),"string"==typeof n&&(t=clone(t),o=interpolate(o=choosePluralForm(n,this.currentLocale,t.smart_count),t)),o},Polyglot.prototype.has=function(e){return e in this.phrases};var delimeter="||||",pluralTypes={chinese:function(){return 0},german:function(e){return 1!==e?1:0},french:function(e){return e>1?1:0},russian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){return 1===e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0}},pluralTypeToLanguages={chinese:["fa","id","ja","ko","lo","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl","pt-br"],russian:["hr","ru"],czech:["cs","sk"],polish:["pl"],icelandic:["is"]};function langToTypeMap(e){var t,n,o,i={};for(t in e)if(e.hasOwnProperty(t))for(o in n=e[t])i[n[o]]=t;return i}var trimRe=/^\s+|\s+$/g;function trim(e){return replace.call(e,trimRe,"")}function choosePluralForm(e,t,n){var o;return null!=n&&e?trim((o=e.split(delimeter))[pluralTypeIndex(t,n)]||o[0]):e}function pluralTypeName(e){var t=langToTypeMap(pluralTypeToLanguages);return t[e]||t.en}function pluralTypeIndex(e,t){return pluralTypes[pluralTypeName(e)](t)}var dollarRegex=/\$/g,dollarBillsYall="$$$$";function interpolate(e,t){for(var n in t)if("_"!==n&&t.hasOwnProperty(n)){var o=t[n];"string"==typeof o&&(o=replace.call(t[n],dollarRegex,dollarBillsYall)),e=replace.call(e,new RegExp("%\\{"+n+"\\}","g"),o)}return e}function warn(e){root.console&&root.console.warn&&root.console.warn("WARNING: "+e)}function clone(e){var t={};for(var n in e)t[n]=e[n];return t}window.Polyglot=Polyglot,rich.LabelLocalized=cc.Class({extends:cc.Component,name:"LabelLocalized",editor:{executeInEditMode:!0,requireComponent:cc.Label,executionOrder:1,disallowMultiple:!0,menu:"rich\u7ec4\u4ef6/LabelLocalized",playOnFocus:!1,inspector:"",icon:"",help:""},properties:{textKey:{default:"",multiline:!0,tooltip:"\u8f93\u5165\u591a\u8bed\u8a00key",notify:function(){this.changeLang()}}},onLoad(){this.textKey&&this.changeLang(),cc.systemEvent.on("CHANGE_LANGUAGE",this.changeLang,this)},changeLang(){let e=this.node.getComponent(cc.Label);if(e){let t=this.parseTextKey(this.textKey);e.string=rich.i18n.t(t.key,t.params);let n=rich.i18n.t("font");if("font"==n)return;if(""==n)e.font=null;else{let t=cc.loader.getRes("/fonts/"+n);t?e.font=t:cc.loader.loadRes("/fonts/"+n,function(t,n){t?(rich.log("\u52a0\u8f7d\u5b57\u4f53\u5931\u8d25,\u8bbe\u7f6e\u6210\u7cfb\u7edf\u9ed8\u8ba4\u5b57\u4f53==",t),e.font=null):e.font=n})}}},parseTextKey(e){let t,n,o={},i=e;if(null==e)return o;let a=e.indexOf("?");a>=0&&(i=e.substr(0,a));let c=(e=e.substr(a+1)).split("&");for(let r=0;r<c.length;r++)(a=c[r].indexOf("="))>0&&(t=c[r].substring(0,a),n=c[r].substr(a+1),o[t]=decodeURIComponent(n));return{key:i,params:o}}});